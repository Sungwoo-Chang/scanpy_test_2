# 1. Annotated data (AnnData)
[Official docs](https://anndata.readthedocs.io/en/latest/)

## 1.1. Anndata 구조
```py
AnnData object with n_obs × n_vars = 2700 × 1000
obs: 'n_counts_all', 'leiden'
var: 'gene_ids', 'n_counts', 'mean', 'std'
uns: 'log1p', 'pca', 'neighbors', 'leiden', 'paga', 'leiden_sizes', 'leiden_colors', 'umap'
obsm: 'X_pca', 'X_umap'
varm: 'PCs'
obsp: 'distances', 'connectivities'
```
### 1.1.1. Obs (observations)
관찰 (observations) metadata를 포함하는 dataframe.\
세포의 클러스터 레이블, 샘플 ID, 실험 조건 등의 정보를 포함\
Rows: 각 세포\
Columns: 각 세포에 대한 메타데이터.
```py
print(adata.obs.head(5))
```
```
                  n_counts_all leiden
index                                
AAACATACAACCAC-1        2421.0      0
AAACATTGAGCTAC-1        4903.0      3
AAACATTGATCAGC-1        3149.0      0
AAACCGTGCTTCCG-1        2639.0      4
AAACCGTGTATGCG-1         981.0      1
```
```py
print(adata.obs['n_count_all'].head(5))
```
```
index
AAACATACAACCAC-1    2421.0
AAACATTGAGCTAC-1    4903.0
AAACATTGATCAGC-1    3149.0
AAACCGTGCTTCCG-1    2639.0
AAACCGTGTATGCG-1     981.0
Name: n_counts_all, dtype: float32
```

### 1.1.2. var (variables)
변수 (variables) 메타데이터를 포함하는 dataframe.\
행은 각 유전자\
열은 각 유전자의 메타데이터를 포함.\
e.g. 유전자의 이름, 염색체 위치, 기능적 설명 등.
```python
print(adata.var.head(5))
```
```
                 gene_ids  n_counts      mean       std
index                                                  
CPSF3L    ENSG00000127054     256.0  0.053175  0.210965
ATAD3C    ENSG00000215915      25.0  0.003054  0.063911
TNFRSF25  ENSG00000215788     239.0  0.052124  0.218310
TNFRSF9   ENSG00000049249      21.0  0.003540  0.060562
CTNNBIP1  ENSG00000178585     198.0  0.036924  0.167438

```

### 1.1.3. uns (unspecified metadata)
구조화되지 않은 메타데이터 (unspecifiec metadata)를 저장하는 dictionary.\
분석 과정에서 생성된 다양한 결과나 추가 정보를 저장.\
e.g. 클러스터링 결과, 시각화 설정, 분석 파라미터 등.
```python
print(adata.uns)
```
> 잘 모르겠음

### 1.1.4. obsm (obs matrix)
observation metadata 중 matrix 형태의 데이터를 저장하는 dataframe.\
주로 dimension reduction이나 clustering 같은 고차원 데이터를 포함.\
각 행렬은 고유한 key로 접근 가능.
```python
print(adata.obsm)
```
```
AxisArrays with keys: X_pca, X_umap
```

```python
print(adata.obsm['X_pca'])
```
```
[[-0.93553823  0.64075714  3.0264673  ...  1.936036   -0.69811034
   2.231086  ]
 [-0.5376465   0.5787394   0.05153081 ... -1.5875354  -1.3934592
   3.0313659 ]
 [-0.54880077  0.1888452   1.7084063  ...  0.5267516   1.0363398
   2.1703484 ]
 ...
 [-0.50398123 -0.07303485 -1.6957036  ... -2.7192442  -1.6577122
  -1.6196314 ]
 [-0.48122194  0.05987059 -0.7461072  ...  1.4041473   0.17339747
  -0.51563835]
 [-0.82102984  0.42712557  1.404809   ...  0.04560408  1.8451111
   0.61611706]]

```
```python
print(adata.obsm['X_umap'])
```
```
[[10.003526   0.6115496]
 [ 4.874579   3.2661617]
 [10.799934   3.3159893]
 ...
 [ 4.57452    3.5660615]
 [ 4.4836593  2.7796192]
 [10.5617485  3.0365486]]
```

### 1.1.5. varm (var matrix)
Variable metadata 중 matrix 형태의 데이터를 저장하는 데이터프레임.\
주로 각 유전자에 대한 고차원 데이터를 포함.\
e.g. PCA의 로딩 벡터, 유전자 간의 상관 행렬 등

```python
print(adata.varm['PCs'])
```
```
[[-2.6331390e-03  2.2282682e-03  2.8939521e-02 ...  2.6228491e-02
  -7.8478456e-03 -2.9177284e-02]
 [-1.2875446e-03  2.3300273e-03  1.2814732e-02 ...  1.4277388e-03
  -3.0660264e-02 -2.2952503e-02]
 [-5.6150178e-03  8.6477473e-03  5.1980957e-02 ...  2.7195469e-02
  -2.5557747e-02  5.0566796e-02]
 ...
 [ 5.0122628e-04 -3.4032033e-03  2.4084216e-02 ...  4.6444191e-03
  -3.3666153e-02 -2.4298556e-02]
 [-1.6598434e-03  8.0140962e-05 -1.0287449e-02 ...  1.9044282e-02
  -3.7579503e-02  4.1323245e-02]
 [-3.7492695e-03  5.1597836e-03  3.1300534e-02 ...  4.6322450e-02
  -7.5045964e-03 -5.0798573e-02]]
```

### 1.1.6. obsp (obs pairwise)
Ovservation 간의 pariwise 관계를 저장하는 sparse matrix.\
주로 세포 간의 거리 행렬이나 인접 행렬을 포함.\
네트워크 분석이나 클러스터링 알고리즘에서 사용될 수 있음.
```python
print(adata.obsp['distances'])
```
```
  (0, 2364)	9.337307929992676
  (0, 848)	9.38521957397461
  (0, 506)	9.861271858215332
  (0, 745)	10.093034744262695
  (0, 2669)	10.137649536132812
  (0, 481)	10.19102954864502
  :	:
  (2699, 1196)	9.065024375915527
  (2699, 988)	9.074718475341797
  (2699, 1768)	9.155962944030762
  (2699, 1535)	9.223206520080566
  (2699, 2633)	9.224773406982422
  (2699, 2595)	9.238943099975586
  (2699, 1407)	9.262426376342773
```
```python
print(adata.obsp['connectivities'])
```
```
  (0, 342)	0.07736276835203171
  (0, 479)	0.20244699716567993
  (0, 481)	0.20485466718673706
  (0, 506)	0.37792545557022095
  (0, 745)	0.9561977386474609
  (0, 848)	1.0
  :	:
  (2699, 1663)	0.1760874092578888
  (2699, 1725)	0.26637667417526245
  (2699, 1768)	0.0601346455514431
  (2699, 1845)	1.0
  (2699, 1859)	0.13579948246479034
  (2699, 2254)	0.17881278693675995
  (2699, 2595)	0.044063638895750046
  (2699, 2633)	0.046466559171676636

```